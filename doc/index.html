<html>
   <head>
      <title>RAII C++ library Documentation</title>
   </head>
   <body>
      <h1>RAII C++ library Documentation</h1>
      <font color="#808080">Copyright &copy; 2010 Ivan Sorokin</font>
      <h2>Table of Content</h2>
      <ul>
         <li><a href="#introduction">Introduction</a></li>
         <li><a href="#tutorial">5-minutes tutorial</a></li>
         <li><a href="#raiiwrapperdef">Resource-wrapper definition</a></li>
         <li><a href="#resourceconfdef">Resource-config definition</a></li>
         <li>
            Reference
            <ul>
               <li>
                  Header &lt;raii/raii.h&gt;
                  <ul>
                     <li><a href="#raiiresource">Class raii::resource</a></li>
                  </ul>
               </li>
               <li><a href="#raiiwinkernel">Header &lt;raii/win_kernel_handles.h&gt;</a></li>
               <li><a href="#raiiwingdi">Header &lt;raii/win_gdi_handles.h&gt;</a></li>
               <li><a href="#raiiwinsocket">Header &lt;raii/win_socket_handle.h&gt;</a></li>
               <li><a href="#raiilibcfile">Header &lt;raii/libc_file_handle.h&gt;</a></li>
               <li><a href="#raiiposix">Header &lt;raii/posix_handles.h&gt;</a></li>
            </ul>
         </li>
         <li><a href="#notes">Notes</a></li>
         <li><a href="#faq">Frequently Asked Questions</a></li>
      </ul>
      <h2 id="introduction">Introduction</h2>
      <p>
         This library provide two facilities
         <ul>
            <li>Facility for writing C++ <a href="#raiiwrapperdef">resource-wrapper</a> class in a convenient, declarative way</li>
            <li>Collection of resource-wrappers for different platforms (Windows API, libc, POSIX)</li>
         </ul>
         The library support C++0x. Every resource-wrapper you create with it will have move constuctor and move assignment operator.
      </p>
      <h2 id="tutorial">5-minutes tutorial</h2>
      <p>
<pre><font color="0000ff"><strong>#include <font color="#008000">&quot;stdio.h&quot;</font></strong></font>

<font color="#444444">// raii::resource is localed here</font>
<font color="0000ff"><strong>#include <font color="#008000">&quot;raii/raii.h&quot;</font></strong></font>

<font color="#444444">// this is a resource config, it contains only three things</font>
<strong>struct</strong> <font color="#2040a0">file_handle_config</font>
<font color="4444FF"><strong>{</strong></font>
   <font color="#444444">// create resource wrapper over FILE *</font>
   <strong>typedef</strong> <font color="#2040a0">FILE</font> <font color="4444FF">*</font> <font color="#2040a0">underlying_resource_type</font><font color="4444FF">;</font>

   <font color="#444444">// invalid value is NULL</font>
   <strong>static</strong> <font color="#2040a0">FILE</font> <font color="4444FF">*</font> <font color="#2040a0">invalid_value</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font> <strong>return</strong> <font color="#2040a0">NULL</font><font color="4444FF">;</font> <font color="4444FF"><strong>}</strong></font>

   <font color="#444444">// dispose function is fclose</font>
   <strong>static</strong> <strong>void</strong> <font color="#2040a0">dispose</font><font color="4444FF">(</font><font color="#2040a0">FILE</font> <font color="4444FF">*</font> <font color="#2040a0">f</font><font color="4444FF">)</font>
   <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">fclose</font><font color="4444FF">(</font><font color="#2040a0">f</font><font color="4444FF">)</font><font color="4444FF">;</font>
   <font color="4444FF"><strong>}</strong></font>
<font color="4444FF"><strong>}</strong></font><font color="4444FF">;</font>

<font color="#444444">// give a short name for resource...</font>
<strong>typedef</strong> <font color="#2040a0">raii</font><font color="4444FF">:</font><font color="4444FF">:</font><font color="#2040a0">resource</font><font color="4444FF">&lt;</font><font color="#2040a0">file_handle_config</font><font color="4444FF">&gt;</font> <font color="#2040a0">file_handle</font><font color="4444FF">;</font>

<strong>int</strong> <font color="#2040a0">main</font><font color="4444FF">(</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
   <font color="#444444">// ... and use it</font>
   <font color="#2040a0">file_handle</font> <font color="#2040a0">f</font><font color="4444FF">(</font><font color="#2040a0">fopen</font><font color="4444FF">(</font><font color="#008000">&quot;test.txt&quot;</font>, <font color="#008000">&quot;r&quot;</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">;</font>

   <font color="#444444">// work with file</font>
   <font color="#444444">// it will be closed automatically</font>

   <strong>return</strong> <font color="#2040a0">EXIT_SUCCESS</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font></pre>
      </p>
      <h2 id="raiiwrapperdef">Resource-wrapper definition</h2>
      <p>
         Resource-wrapper class <code>T</code> is a class an instance of that contains an object of type
         <code>underlying_resource_type</code> and has the following public members:
         <table>
            <tr>
               <td>Member</td>
               <td>Description</td>
            </tr>
            <tr>
               <td><code>T::underlying_resource_type</code></td>
               <td>An type of object we hold</td>
            </tr>
            <tr>
               <td><code>T::T()</code></td>
               <td>Create an wrapper that owns nothing</td>
            </tr>
            <tr>
               <td><code>explicit T::T(underlying_resource_type const &&)</code></td>
               <td>Take ownership of resource</td>
            </tr>
            <tr>
               <td><code>T::T(T && other)</code></td>
               <td>Take an ownership from <code>other</code>. After this operation this object owns the resource
               that object <code>other</code> owns before. After this operation <code>other</code> owns nothing</td>
            </tr>
            <tr>
               <td><code>T & T::operator=(T && other)</code></td>
               <td>Release ownership of object we own and take it from <code>other</code>. After this operation
               this object owns the resource that object <code>other</code> owns before. After this operation <code>other</code>
               owns nothing</td>
            </tr>
            <tr>
               <td><code>T::~T()</code></td>
               <td>Release ownership</td>
            </tr>
            <tr>
               <td><code>void T::reset(underlying_resource_type const & underlying_resource)</code></td>
               <td>Release ownership of object we own and take it over <code>underlying_resource</code></td>
            </tr>
            <tr>
               <td><code>underlying_resource_type T::release()</code></td>
               <td>Release ownership of object we own and return underlying resource</td>
            </tr>
            <tr>
               <td><code>underlying_resource_type T::get() const</code></td>
               <td>Returns copy of underlying resource</td>
            </tr>
            <tr>
               <td><code>operator &lt;unspecified-bool-type&gt;() const</code></td>
               <td>Returns true if we own some resource, false elsewhere</td>
            </tr>
            <tr>
               <td><code>void std::swap(T & a, T & b)</code></td>
               <td>Swap two resource-wrappers. After this operation object <code>a</code> owns a resource that
               <code>b</code> owned before. And <code>b</code> owns a resource that <code>a</code> owned
               before</td>
            </tr>
         </table>
      </p>
      <h2 id="resourceconfdef">Resource-config definition</h2>
      <p>
         Resource-config class <code>T</code> is a class that have the following public members:
         <table>
            <tr>
               <td>Member</td>
               <td>Description</td>
            </tr>
            <tr>
               <td><code>T::underlying_resource_type</code></td>
               <td>An type of object that corresponding resource-wrapper hold</td>
            </tr>
            <tr>
               <td><code>static T::underlying_resource_type T::invalid_value()</code></td>
               <td>The value that valid object of type <code>underlying_resource_type</code> can not have.
               If resource-wrapper underlying resource has this value it means that RAII-wrapper does not
               own any resource.</td>
            </tr>
            <tr>
               <td><code>static void dispose(T::underlying_resource_type const &)</code></td>
               <td>Release an resource</td>
            </tr>
         </table>
      </p>
      <h2 id="raiiresource">Class raii::resource</h2>
      <p>
         Class <code>raii::resource</code> is parametrized with <a href="#resourceconfdef">resource-config</a>
         type and provide <a href="#raiiwrapperdef">resource-wrapper</a> interface. See <a href="../raii/raii.h">&lt;raii/raii.h&gt;</a>.
      </p>
      <h2 id="raiiwinkernel">Header <a href="../raii/win_kernel_handles.h">&lt;raii/win_kernel_handles.h&gt;</a></h2>
      <p>
         <table>
            <tr>
               <td>resource wrapper</td>
               <td>underlying resource type</td>
               <td>invalid value</td>
               <td>dispose function</td>
            </tr>
            <tr>
               <td><code>raii::win::file_handle</code></td>
               <td><code>HANDLE</code></td>
               <td><code>INVALID_HANDLE_VALUE</code></td>
               <td><code>CloseHandle</code></td>
            </tr>
            <tr>
               <td><code>raii::win::kernel_handle</code></td>
               <td><code>HANDLE</code></td>
               <td><code>NULL</code></td>
               <td><code>CloseHandle</code></td>
            </tr>
            <tr>
               <td><code>raii::win::find_file_handle</code></td>
               <td><code>HANDLE</code></td>
               <td><code>NULL</code></td>
               <td><code>FindClose</code></td>
            </tr>
            <tr>
               <td><code>raii::win::module_handle</code></td>
               <td><code>HMODULE</code></td>
               <td><code>NULL</code></td>
               <td><code>FreeLibrary</code></td>
            </tr>
            <tr>
               <td><code>raii::win::map_file_view_handle</code></td>
               <td><code>void *</code></td>
               <td><code>NULL</code></td>
               <td><code>UnmapViewOfFile</code></td>
            </tr>
         </table>
      </p>
      <h2 id="raiiwingdi">Header <a href="../raii/win_gdi_handles.h">&lt;raii/win_gdi_handles.h&gt;</a></h2>
         <table>
            <tr>
               <td>resource wrapper</td>
               <td>underlying resource type</td>
               <td>invalid value</td>
               <td>dispose function</td>
            </tr>
            <tr>
               <td><code>raii::win::accelerator_table_handle</code></td>
               <td><code>HACCEL</code></td>
               <td><code>NULL</code></td>
               <td><code>DestroyAcceleratorTable</code></td>
            </tr>
            <tr>
               <td><code>raii::win::gdiobj_handle</code></td>
               <td><code>HGDIOBJ</code></td>
               <td><code>NULL</code></td>
               <td><code>DeleteObject</code></td>
            </tr>
            <tr>
               <td><code>raii::win::cursor_handle</code></td>
               <td><code>HCURSOR</code></td>
               <td><code>NULL</code></td>
               <td><code>DestroyCursor</code></td>
            </tr>
            <tr>
               <td><code>raii::win::icon_handle</code></td>
               <td><code>HICON</code></td>
               <td><code>NULL</code></td>
               <td><code>DestroyIcon</code></td>
            </tr>
            <tr>
               <td><code>raii::win::menu_handle</code></td>
               <td><code>HMENU</code></td>
               <td><code>NULL</code></td>
               <td><code>DestroyMenu</code></td>
            </tr>
            <tr>
               <td><code>raii::win::window_handle</code></td>
               <td><code>HWND</code></td>
               <td><code>NULL</code></td>
               <td><code>DestroyWindow</code></td>
            </tr>
         </table>
      <h2 id="raiiwinsocket">Header <a href="../raii/win_socket_handle.h">&lt;raii/win_socket_handle.h&gt;</a></h2>
      <p>
         <table>
            <tr>
               <td>resource wrapper</td>
               <td>underlying resource type</td>
               <td>invalid value</td>
               <td>dispose function</td>
            </tr>
            <tr>
               <td><code>raii::win::socket_handle</code></td>
               <td><code>SOCKET</code></td>
               <td><code>INVALID_SOCKET</code></td>
               <td><code>closesocket</code></td>
            </tr>
         </table>
      </p>
      <h2 id="raiilibcfile">Header <a href="../raii/libc_file_handle.h">&lt;raii/libc_file_handle.h&gt;</a></h2>
      <p>
         <table>
            <tr>
               <td>resource wrapper</td>
               <td>underlying resource type</td>
               <td>invalid value</td>
               <td>dispose function</td>
            </tr>
            <tr>
               <td><code>raii::libc::file_handle</code></td>
               <td><code>FILE *</code></td>
               <td><code>NULL</code></td>
               <td><code>fclose</code></td>
            </tr>
         </table>
      </p>
      <h2 id="raiiposix">Header <a href="../raii/posix_handles.h">&lt;raii/posix_handles.h&gt;</a></h2>
      <p>
         <table>
            <tr>
               <td>resource wrapper</td>
               <td>underlying resource type</td>
               <td>invalid value</td>
               <td>dispose function</td>
            </tr>
            <tr>
               <td><code>raii::posix::dirent_handle</code></td>
               <td><code>DIR *</code></td>
               <td><code>NULL</code></td>
               <td><code>closedir</code></td>
            </tr>
            <tr>
               <td><code>raii::posix::file_handle</code></td>
               <td><code>int</code></td>
               <td><code>-1</code></td>
               <td><code>close</code></td>
            </tr>
            <tr>
               <td><code>raii::posix::map_file_view_handle</code></td>
               <td><code>std::pair&lt;void *, size_t&gt;</code></td>
               <td><code>(MAP_FAILED, 0)</code></td>
               <td><code>munmap</code></td>
            </tr>
         </table>
      </p>
      <h2 id="notes">Notes</h2>
      <p>
         Standard Windows system headers are sensitive to inclusion order. So none of Windows-specific
         headers of this library includes &lt;windows.h&gt;. The user should include it manually in order
         he want.
      </p>
      <p>
         POSIX- and libc- headers include corresponding system headers itselves.
      </p>
      <h2 id="faq">Frequently Asked Questions</h2>
      <p>
         <h3>Can I use <code>raii::resource</code> if my <code>type</code> does not have invalid value?</h3>
         Yes, you can. You can create resource with <code>underlying_resource_type = boost::optional&lt;type&gt;</code>.
         Invalid value of this resource will be <code>boost::none</code>.
      </p>
   </body>
</html>
